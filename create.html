<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ResumeAI — Create Resume</title>
  <style>
    body{margin:0;font-family:Inter,system-ui,Arial;background:#0b0f19;color:#e5e7eb}
    .wrap{max-width:980px;margin:auto;padding:40px 20px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    label{font-size:13px;color:#9ca3af}
    input,textarea,select{
      width:100%;padding:12px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:#111827;color:#e5e7eb;outline:none;
    }
    textarea{min-height:110px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:14px}
    button{
      padding:12px 16px;border:0;border-radius:12px;
      background:linear-gradient(135deg,#7b5cff,#5b3dff);
      color:#fff;font-weight:800;cursor:pointer;
    }
    button:disabled{opacity:.6;cursor:not-allowed}
    .muted{color:#9ca3af;font-size:13px}
    .card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <a id="t_back" href="/index.html" style="color:#a5b4fc;text-decoration:none;">← Back</a>
    <h1 id="t_title" style="margin:10px 0 4px 0;">Create your resume</h1>
    <div id="t_sub" class="muted">Fill your details → ResumeAI writes strong bullets → export ATS/Modern PDF.</div>

    <div class="card" style="margin-top:16px">
      <div class="grid">
        <div>
          <label id="t_lang_label">Language</label>
          <select id="lang">
            <option value="en">English</option>
            <option value="tr">Türkçe</option>
            <option value="es">Español</option>
            <option value="ru">Русский</option>
            <option value="fr">Français</option>
            <option value="ar">العربية</option>
            <option value="zh">中文</option>
          </select>
        </div>
        <div>
          <label id="t_jd_label">Optional: Job description (for tailoring)</label>
          <input id="jd" placeholder="Paste job description (optional)" />
        </div>

        <div>
          <label id="t_fullname_label">Full name</label>
          <input id="fullName" placeholder="John Doe" />
        </div>
        <div>
          <label id="t_title_label">Title</label>
          <input id="title" placeholder="Marketing Manager / Frontend Developer" />
        </div>

        <div>
          <label id="t_location_label">Location</label>
          <input id="location" placeholder="Istanbul, TR" />
        </div>
        <div>
          <label id="t_email_label">Email</label>
          <input id="email" placeholder="you@email.com" />
        </div>

        <div>
          <label id="t_phone_label">Phone</label>
          <input id="phone" placeholder="+90 ..." />
        </div>
        <div>
          <label id="t_links_label">Links (one per line: Label | URL)</label>
          <input id="links" placeholder="LinkedIn | https://linkedin.com/in/..." />
        </div>

        <div>
          <label id="t_skills_label">Skills (comma separated)</label>
          <input id="skills" placeholder="GA4, SEO, SQL, React, ..." />
        </div>
        <div>
          <label id="t_langs_label">Languages (one per line: Name | Level)</label>
          <input id="langs" placeholder="English | Native&#10;Turkish | Native" />
        </div>
      </div>

      <div style="margin-top:14px">
        <label id="t_exp_label">Experience (one role per block)</label>
        <textarea id="experience" placeholder=
"Role: Marketing Manager
Company: ABC
Start: 2022
End: Present
Location: Remote
Notes: ran paid search, improved landing pages

Role: ..."
        ></textarea>
        <div id="t_notes_hint" class="muted" style="margin-top:6px">
          Notes = your raw text; ResumeAI turns it into strong bullets.
        </div>
      </div>

      <!-- EDUCATION -->
      <div style="margin-top:14px">
        <label id="t_edu_label">Education (one item per block)</label>
        <textarea id="education" placeholder=
"School: University of X
Degree: BSc Computer Engineering
Start: 2016
End: 2020
Notes: (optional) GPA, honors, relevant coursework

School: ..."
        ></textarea>
        <div id="t_edu_hint" class="muted" style="margin-top:6px">Optional. Leave empty if you don’t have it.</div>
      </div>

      <!-- PROJECTS -->
      <div style="margin-top:14px">
        <label id="t_proj_label">Projects (one project per block)</label>
        <textarea id="projects" placeholder=
"Name: ResumeAI.work
Tech: Next.js, OpenAI API, Upstash
Notes: built ATS analyzer + PDF exports

Name: ..."
        ></textarea>
        <div id="t_proj_hint" class="muted" style="margin-top:6px">Tech = comma separated. Notes = what you did; ResumeAI turns it into bullets.</div>
      </div>

      <div class="row">
        <button id="btn"><span id="t_btn">Generate CV + PDF</span></button>
        <div id="status" class="muted"></div>
      </div>
    </div>
  </div>

<script>
const I18N = {
  en: {
    back: "← Back",
    title: "Create your resume",
    sub: "Fill your details → ResumeAI writes strong bullets → export ATS/Modern PDF.",
    langLabel: "Language",
    jdLabel: "Optional: Job description (for tailoring)",
    fullNameLabel: "Full name",
    titleLabel: "Title",
    locationLabel: "Location",
    emailLabel: "Email",
    phoneLabel: "Phone",
    linksLabel: "Links (one per line: Label | URL)",
    skillsLabel: "Skills (comma separated)",
    langsLabel: "Languages (one per line: Name | Level)",
    expLabel: "Experience (one role per block)",
    notesHint: "Notes = your raw text; ResumeAI turns it into strong bullets.",
    eduLabel: "Education (one item per block)",
    eduHint: "Optional. Leave empty if you don’t have it.",
    projLabel: "Projects (one project per block)",
    projHint: "Tech = comma separated. Notes = what you did; ResumeAI turns it into bullets.",
    btn: "Generate CV + PDF",
    generating: "Generating…",
    done: "Done ✅ Opening PDF…",
    errPrefix: "Error: "
  },
  tr: {
    back: "← Geri",
    title: "CV’ni oluştur",
    sub: "Bilgilerini doldur → ResumeAI güçlü bullet’lar yazar → ATS/Modern PDF indir.",
    langLabel: "Dil",
    jdLabel: "Opsiyonel: İş ilanı metni (tailoring için)",
    fullNameLabel: "Ad Soyad",
    titleLabel: "Ünvan",
    locationLabel: "Konum",
    emailLabel: "E-posta",
    phoneLabel: "Telefon",
    linksLabel: "Linkler (satır satır: Etiket | URL)",
    skillsLabel: "Yetenekler (virgülle ayır)",
    langsLabel: "Diller (satır satır: Dil | Seviye)",
    expLabel: "Deneyim (her rol ayrı blok)",
    notesHint: "Notes = ham cümlelerin; ResumeAI bunu güçlü bullet’lara çevirir.",
    eduLabel: "Eğitim (her kayıt ayrı blok)",
    eduHint: "Opsiyonel. Yoksa boş bırak.",
    projLabel: "Projeler (her proje ayrı blok)",
    projHint: "Tech = virgülle ayır. Notes = yaptıkların; ResumeAI bullet’a çevirir.",
    btn: "CV + PDF oluştur",
    generating: "Oluşturuluyor…",
    done: "Bitti ✅ PDF açılıyor…",
    errPrefix: "Hata: "
  }
};

function t(){
  const lang = (document.getElementById("lang")?.value || "en").toLowerCase();
  return I18N[lang] || I18N.en;
}

function applyLangUI(){
  const tt = t();
  const set = (id, val) => { const el = document.getElementById(id); if(el) el.textContent = val; };

  set("t_back", tt.back);
  set("t_title", tt.title);
  set("t_sub", tt.sub);
  set("t_lang_label", tt.langLabel);
  set("t_jd_label", tt.jdLabel);
  set("t_fullname_label", tt.fullNameLabel);
  set("t_title_label", tt.titleLabel);
  set("t_location_label", tt.locationLabel);
  set("t_email_label", tt.emailLabel);
  set("t_phone_label", tt.phoneLabel);
  set("t_links_label", tt.linksLabel);
  set("t_skills_label", tt.skillsLabel);
  set("t_langs_label", tt.langsLabel);
  set("t_exp_label", tt.expLabel);
  set("t_notes_hint", tt.notesHint);
  set("t_edu_label", tt.eduLabel);
  set("t_edu_hint", tt.eduHint);
  set("t_proj_label", tt.projLabel);
  set("t_proj_hint", tt.projHint);
  set("t_btn", tt.btn);
}

function parseLinks(v){
  const lines = String(v||"").split("\n").map(x=>x.trim()).filter(Boolean);
  return lines.slice(0,6).map(line=>{
    const parts = line.split("|").map(s=>s.trim());
    return { label: parts[0] || "Link", url: parts[1] || "" };
  }).filter(x=>x.url);
}

function parseLangs(v){
  const lines = String(v||"").split("\n").map(x=>x.trim()).filter(Boolean);
  return lines.slice(0,10).map(line=>{
    const parts = line.split("|").map(s=>s.trim());
    return { name: parts[0] || "", level: parts[1] || "" };
  }).filter(x=>x.name);
}

function parseExperience(v){
  const blocks = String(v||"").split(/\n\s*\n/).map(b=>b.trim()).filter(Boolean);
  return blocks.slice(0,10).map(b=>{
    const get = (key)=>{
      const m = b.match(new RegExp("^"+key+"\\s*:\\s*(.+)$","im"));
      return m ? m[1].trim() : "";
    };
    const notes = get("Notes");
    return {
      position: get("Role"),
      company: get("Company"),
      start: get("Start"),
      end: get("End") || null,
      location: get("Location"),
      highlights: notes ? [notes] : []
    };
  }).filter(x=>x.position || x.company);
}

function parseEducation(v){
  const blocks = String(v||"").split(/\n\s*\n/).map(b=>b.trim()).filter(Boolean);
  return blocks.slice(0,10).map(b=>{
    const get = (key)=>{
      const m = b.match(new RegExp("^"+key+"\\s*:\\s*(.+)$","im"));
      return m ? m[1].trim() : "";
    };
    return {
      school: get("School"),
      degree: get("Degree"),
      start: get("Start"),
      end: get("End")
    };
  }).filter(x => x.school || x.degree);
}

function parseProjects(v){
  const blocks = String(v||"").split(/\n\s*\n/).map(b=>b.trim()).filter(Boolean);
  return blocks.slice(0,10).map(b=>{
    const get = (key)=>{
      const m = b.match(new RegExp("^"+key+"\\s*:\\s*(.+)$","im"));
      return m ? m[1].trim() : "";
    };
    const tech = get("Tech");
    const notes = get("Notes");
    return {
      name: get("Name"),
      tech: tech ? tech.split(",").map(x=>x.trim()).filter(Boolean) : [],
      highlights: notes ? [notes] : []
    };
  }).filter(x => x.name);
}

applyLangUI();
document.getElementById("lang").addEventListener("change", applyLangUI);

document.getElementById("btn").addEventListener("click", async ()=>{
  const btn = document.getElementById("btn");
  const status = document.getElementById("status");
  const lang = document.getElementById("lang").value;
  const tt = t();

  btn.disabled = true;
  status.textContent = tt.generating;

  const jd = document.getElementById("jd").value;

  const profile = {
    fullName: document.getElementById("fullName").value,
    title: document.getElementById("title").value,
    location: document.getElementById("location").value,
    phone: document.getElementById("phone").value,
    email: document.getElementById("email").value,
    links: parseLinks(document.getElementById("links").value),
    skills: String(document.getElementById("skills").value||"").split(",").map(x=>x.trim()).filter(Boolean),
    languages: parseLangs(document.getElementById("langs").value),
    experience: parseExperience(document.getElementById("experience").value),
    education: parseEducation(document.getElementById("education").value),
    projects: parseProjects(document.getElementById("projects").value),
    certificates: []
  };

  try{
    const r = await fetch("/api/create", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      credentials:"include",
      body: JSON.stringify({ profile, jd, lang, preview:false })
    });

    const data = await r.json().catch(()=> ({}));
    if(!r.ok) throw new Error(data?.error || ("Request failed ("+r.status+")"));

    localStorage.setItem("resumeai_cvdata", JSON.stringify(data.cv_data));
    status.textContent = tt.done;
    window.location.href = `/cv.html?lang=${encodeURIComponent(lang)}#mode=ats`;
  }catch(e){
    status.textContent = tt.errPrefix + (e?.message || e);
  }finally{
    btn.disabled = false;
  }
});
</script>
</body>
</html>
